<!-- qr-scan.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Attendance Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    #reader { width: 300px; margin: auto; }
    .msg { margin-top: 20px; font-size: 18px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Scan QR for Attendance</h2>
  <div id="reader"></div>
  <div class="msg" id="message"></div>
  <div id="debug" style="color:red; font-weight:bold; margin-top: 20px;"></div>

<script>
  const sheetUrl = 'https://script.google.com/macros/s/AKfycbycaNZ-V8ZRC4eQOPIzwdbOiNEgeHto5YZdN6ObEWUuFUxLeSkJ8Gyf-ByLxzTU9wnN/exec';
  const message = document.getElementById('message');
  const debug = document.getElementById('debug');

  function markAttendance(qrCodeText) {
    debug.innerText = 'ðŸ“¤ Sending QR: ' + qrCodeText;

    fetch(sheetUrl, {
      method: 'POST',
      body: JSON.stringify({ qr: qrCodeText }),
      headers: { 'Content-Type': 'application/json' }
    })
    .then(res => res.text())
    .then(text => {
      message.textContent = text;
      debug.innerText += '\nâœ… Response: ' + text;
    })
    .catch(err => {
      message.textContent = 'âŒ Error saving attendance';
      debug.innerText += '\nâŒ Error: ' + err.message;
    });
  }

  const html5QrCode = new Html5Qrcode("reader");
  html5QrCode.start({ facingMode: "environment" }, {
    fps: 10, qrbox: 250
  }, 
  qrText => {
    html5QrCode.stop();
    message.textContent = 'âœ… QR scanned: ' + qrText;
    debug.innerText = 'ðŸ“¥ Scanned QR: ' + qrText;
    markAttendance(qrText);
  });
</script>

</body>
</html>
